## [FranticApparatus 0.2](https://github.com/jkolb/FranticApparatus)

FranticApparatus is a composable task framework for iOS. Tasks are units of work that execute, optionally generate a result, and trigger events during important points during their life-cycle. Tasks are most useful when they are asynchronous but there is nothing stopping them from being synchronous. Tasks are built on top of a protocol, FATask, this aids in composability and allowing for almost anything to be modeled as a task. If you have existing asynchronous functionality their is a good chance you can hide it behind the FATask protocol and gain the benefits that come from composability.

The best way to illustrate the power of composable tasks is with an example:

	- (id <FATask>)imageDownloadTask {
		FAChainedBatchTask *imageDownloadTask = [[FAChainedBatchTask alloc] init];

		FAURLConnectionDataTask *networkTask = [[FAURLConnectionDataTask alloc] init];
		networkTask.queue = self.networkQueue;
		[imageDownloadTask addTask:networkTask];

		FAResultBlockTask *imageTask = [[FAResultBlockTask alloc] init];
		[imageTask setGenerateResult:^id (FAURLResult *result, NSError **error) {
			UIImage *image = [[UIImage alloc] initWithData:result.data];
			if (image == nil) {
				if (error != NULL) {
					*error = [NSError errorWithDomain:@"CustomAPIDomain" code:100 userInfo:nil];
				}
				return nil;
			}
			return image;
		}];
		[imageDownloadTask addTask:imageTask];
		
		return imageDownloadTask;
	}
	
	- (id <FATask>)imageDownloadAndResizeTask:(CGSize)imageSize {
		FAChainedBatchTask *imageDownloadAndResizeTask = [[FAChainedBatchTask alloc] init];
		
		[imageDownloadAndResizeTask addTask:[self imageDownloadTask]];
		
		FAResultBlockTask *resizeTask = [[FAResultBlockTask alloc] init];
		typeof(self) __weak weakSelf = self;
		[resizeTask setGenerateResult:^id (UIImage *image, NSError **error) {
			typeof(self) blockSelf = weakSelf;
			return [blockSelf resizeImage:image toSize:imageSize];
		}];
		[imageDownloadAndResizeTask addTask:imageTask];
		
		return imageDownloadAndResizeTask;
	}
	
	- (UIImage *)resizeImage:(UIImage *)image toSize:(CGSize)size {
		...
	}
	
	...
	
	FAUITask *task = [[FAUITask alloc] init];
	task.backgroundTask = [api imageDownloadAndResizeTask:CGSizeMake(100, 100)];
	[task addTarget:self action:@selector(downloadedImage:) forTaskEvent:FATaskEventSucceeded];
	[task addTarget:self action:@selector(downloadFailedWithError:) forTaskEvent:FATaskEventFailed];
	
	self.task = task;
	
	NSURLRequest *request = [api requestForImageWithURL:imageURL];
	[self.task startWithParameter:request];
	
	...
	
	- (void)downloadedImage:(UIImage *)image {
		self.imageView.image = image;
	}
	
	- (void)downloadFailedWithError:(NSError *)error {
		NSLog(@"Error: %@", error);
	}
	
In this example there are three levels of nested tasks, but to the final level they can all be treated as a single unit of work. The top level is being executed in the UI on the main thread. FAUITask wraps the execution of a background task that is most likely executing on a thread other than the main thread and ensures delivery of the callbacks to the main thread. Actions are registered on this task to handle the final result, or error, of the task's computations. The task returned by imageDownloadAndResizeTask: wraps the task returned by imageDownloadTask and performs extra work to resize the image generated by that task. Lastly the task returned by imageDownloadTask wraps two tasks, one that downloads an image from a remote server, and another that turns the returned data into an instance of UIImage, generating an error if it is unable to do so.

## How To Get Started

Currently FranticApparatus can either be used by copying it's source files directly into your project, or by using it as a static library by dragging and dropping the FranticApparatus.xcodeproj file into your project or workspace. CocoaPods integration is forthcoming.

## Requirements

FranticApparatus 0.2 and higher requires iOS 6.0 and above.

## Contact

[Justin Kolb](https://github.com/jkolb)  
[@nabobnick](https://twitter.com/nabobnick)

## License

FranticApparatus is available under the MIT license. See the LICENSE file for more info.
